<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Meisinger Two"><meta property="og:type" content="article"><meta property="og:image" content="https://meisinger.github.io//assets/images/header-code.jpg"><meta property="twitter:image" content="https://meisinger.github.io//assets/images/header-code.jpg"><meta name=title content="Fun with xUnit Assert Throws and App Domains"><meta property="og:title" content="Fun with xUnit Assert Throws and App Domains"><meta property="twitter:title" content="Fun with xUnit Assert Throws and App Domains"><meta name=description content="A friendly blog covering my journey through software development over the past twenty years"><meta property="og:description" content="A friendly blog covering my journey through software development over the past twenty years"><meta property="twitter:description" content="A friendly blog covering my journey through software development over the past twenty years"><meta property="og:url" content="https://meisinger.github.io/post/2014-03-27-fun-with-xunit-assert-throws-and-app-domains/"><meta property="twitter:card" content="summary"><meta name=keyword content><link rel="shortcut icon" href=/img/favicon.ico><title>Fun with xUnit Assert Throws and App Domains - Meisinger Two</title><link rel=canonical href=/post/2014-03-27-fun-with-xunit-assert-throws-and-app-domains/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css integrity=sha512-... crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/scss/main.css></head><body><nav><div><div class=title-container><button type=button>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=site-title href=/>Meisinger Two
<span class=site-slogan>Soul Proprietor</span></a></div><div class=menu-items-container><ul class=menu-items><li><a href=/>Home</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></div></div><script>var $toggle=document.querySelector(".navbar-toggle");$toggle.addEventListener("click",toggle_navbar);function toggle_navbar(){var t=document.querySelector("#huxblog_navbar"),n=document.querySelector(".navbar-collapse");t.className.indexOf("in")>0?(t.className=" ",setTimeout(function(){t.className.indexOf("in")<0&&(n.style.height="0px")},400)):(n.style.height="auto",t.className+=" in")}</script></nav><article><section class=header><h2 data-label=title>Fun with xUnit Assert Throws and App Domains</h2><h6 data-label=reading-time><i class="fa fa-clock"></i>
3 minute read</h6></section><section class=content><p>I recently decided to update the shared libraries and tools that are used to build and unit test Rhino Mocks.</p><p>I updated <a href=https://github.com/psake/psake>psake</a> from version 0.22 to version 4.3.1.0.
Now I don’t know about you but that is a significant jump in version number. After the update, no problems.
I actually find it easier to deal with and have come to the realization that I should revisit the existing tasks.</p><p>I then went ahead and update <a href=https://github.com/xunit/xunit>xUnit</a> from version 1.1.0 to version 1.9.2.
After the update I had a significant number of build errors. All of the build errors were concerning the <code>Assert.Throws</code> extension method.
In the old version this method had an overload that took a “message” as a parameter.
In the latest version this overload was removed.</p><p>I was very concerned with this breaking change.
There were so many unit tests that used this method to verify the thrown exception message matched the expectation.
I cracked open the previous version in dotPeek and took a look at the method.
And what I saw was rather surprising.</p><div class=highlight><pre tabindex=0 style=color:#c8d3f5;background-color:#222436;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#c099ff>public</span> <span style=color:#c099ff>static</span> T Throws&lt;T&gt;(<span style=color:#4fd6be>string</span> userMessage, ThrowsDelegate testCode)
</span></span><span style=display:flex><span>  <span style=color:#c099ff>where</span> T: Exception
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#c099ff>return</span> (T) Throws(<span style=color:#c099ff>typeof</span>(T), testCode);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Clearly the <code>userMessage</code> parameter is not being used.</p><p>Now realizing that the “message” parameter was never being used.
I changed all of the unit tests and removed the messages being passed.
After I fixed the unit tests everything was working perfectly.
This has now become a fortunate change of events.
This now provides me with the ability to change the exception messages to provide better context and more information.</p><p>All was right in the world. Well…</p><p>It was an hour after the update that I realized that I only updated the <a href=https://github.com/xunit/xunit>xUnit</a> libraries.
I hadn’t updated the executable or console application that actually ran the unit tests.
So back to NuGet I went to get the latest (stable) version of the <a href=https://github.com/xunit/xunit>xUnit</a> console application.</p><p>This is where things took a turn for the worse. There was one (and only one) unit test that was now failing.
I am going to give you the namespace and test class name and let you figure out what the problem was: <strong>Rhino.Mocks.Test.Remoting.ContextSwitchTests</strong></p><p>Talk about fun.</p><p>I will save you the gory (and embarrassing) details on how I corrected the problem.
The bottom line is that I had to change the way the unit test was creating the App Domain to match the same
way the <a href=https://github.com/xunit/xunit>xUnit</a> was loading the unit test into it’s App Domain.</p><p>There’s a lesson in here somewhere but right now… I can’t think of it.</p><p>Coming up next is documentation and getting the first 4.0.0 alpha build out on NuGet.</p></section><section class=footer><div class=tags><label>Tags:</label><div data-type=taxonomy><a href=/tags/xunit title=xUnit>xUnit</a></div></div><div class=categories><label>Categories:</label><div data-type=taxonomy><a href=/categories/development title=Development>Development</a></div></div><h6 data-label=meta>Posted on Thursday, March 27, 2014</h6></section><section class=navigation><a href=/post/2014-03-17-rhino-mocks-nuget/>Previous
</a><a href=/post/2014-03-31-rhino-mocks-4-0-0-alpha-released/>Next</a></section></article><footer><ul><li><a href=mailto:mike.meisinger@gmail.com><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/meisinger><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/yourlinkedinid><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li></ul><div data-label=copyright>Copyright &copy; 2025 Mike Meisinger</div></footer></body></html>